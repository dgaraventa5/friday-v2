{
  "rules": [
    {
      // Global defaults for the whole repo
      "pattern": "**/*",
      "instructions": [
        "This repository contains Friday v2: a focused task manager that helps users pick and execute a small number of important tasks each day.",
        "Tech stack (baseline): Next.js + React + TypeScript, Supabase (Postgres + Auth) as the backend, Tailwind CSS for styling, and deployment on Vercel.",
        "Favor clarity, reliability, and simplicity over clever abstractions.",
        "Do NOT introduce new major frameworks or libraries (state management, styling, routing, backend) unless explicitly requested.",
        "All secrets and API keys must remain server-side (e.g. in Next.js server components or API routes). Never expose secrets to the client.",
        "All AI/model calls must go through server-side API routes (e.g. /api/ai/*) or server utilities. Do not call OpenAI/Claude directly from client components.",
        "Prefer small, incremental changes that are easy to review over large refactors.",
        "Maintain or improve TypeScript types when editing code. Avoid using 'any' unless absolutely necessary, and document why in a comment.",
        "Reuse existing patterns, utilities, and conventions in this codebase instead of inventing new ones.",
        "When modifying behavior that affects users (task scoring, scheduling, auth, core flows), also update or add tests."
      ]
    },
    {
      // App router / pages
      "pattern": "app/**",
      "instructions": [
        "Routes under app/ follow the Next.js App Router conventions. Prefer creating new routes here rather than in pages/ if both exist.",
        "Use server components by default, and client components only when interactivity or browser APIs are required.",
        "When adding data fetching logic, consider whether it belongs in a server component (preferred) or in a client-side hook.",
        "Keep route handlers focused. Move reusable logic into lib/ or services/ modules."
      ]
    },
    {
      "pattern": "pages/**",
      "instructions": [
        "If pages/ exists, it may contain legacy routes. Do not add new routes here unless the project is clearly using the Pages Router everywhere.",
        "When editing pages/, avoid mixing in new routing paradigms. Follow the established pattern in this directory."
      ]
    },
    {
      // Components
      "pattern": "components/**",
      "instructions": [
        "components/ should contain presentational and small container components used across the app.",
        "Favor small, composable components with clear props over giant, multi-purpose components.",
        "Keep components free of direct Supabase or API calls when possible; instead, depend on props or hooks defined in lib/.",
        "Use existing Tailwind utility patterns and design primitives for consistency.",
        "When editing core UX components (Today view, backlog list, task editor), add or update React Testing Library tests in tests/components/."
      ]
    },
    {
      // Business logic and data access
      "pattern": "lib/**",
      "instructions": [
        "lib/ holds reusable business logic, utilities, hooks, and data-access helpers (e.g. Supabase clients, task services).",
        "Keep functions pure and side-effect free where possible, especially for scoring, filtering, and scheduling tasks.",
        "When changing task scoring or scheduling logic, add or update unit tests in tests/lib/ to lock in behavior.",
        "For Supabase, keep a single shared client creator and avoid scattering direct client creation across the codebase.",
        "If a function grows complex, prefer extracting smaller helpers over adding ad-hoc conditionals."
      ]
    },
    {
      // API routes
      "pattern": "app/api/**",
      "instructions": [
        "These are server-side API routes. They may call Supabase and external APIs like OpenAI or Claude using server-side environment variables.",
        "Validate and sanitize all input. Never trust client payloads.",
        "Handle error cases explicitly and return safe, user-friendly error messages (do not leak stack traces or secrets).",
        "All AI-related routes should be deterministic where possible (controlled temperature, clear schema) and return well-typed JSON.",
        "When editing or adding an API route, create or update tests in tests/api/ for both success and failure paths."
      ]
    },
    {
      // Tests
      "pattern": "tests/**",
      "instructions": [
        "Tests should be written with Vitest (for unit/integration) and React Testing Library (for components) unless otherwise specified.",
        "Prioritize tests for critical logic: auth flows, task scoring/scheduling, Today/Backlog views, and AI endpoints.",
        "Keep tests fast, deterministic, and readable. Use realistic but minimal fixtures.",
        "When fixing a bug, add a regression test that fails before the fix and passes afterward.",
        "Avoid over-mocking; prefer testing behavior over implementation details."
      ]
    },
    {
      // Styling
      "pattern": "styles/**",
      "instructions": [
        "Use Tailwind CSS and existing design tokens/utilities.",
        "Do not introduce new global CSS frameworks or reset styles unless explicitly requested.",
        "Keep global styles minimal; prefer composable Tailwind utility classes in components."
      ]
    },
    {
      // Config & infra
      "pattern": "{next.config.*,@types/**,scripts/**}",
      "instructions": [
        "Be conservative when changing configuration files; small mistakes can break builds or deployments.",
        "Document configuration changes in comments or in ARCHITECTURE.md when they impact how the app runs or deploys.",
        "Do not rename environment variables or remove required ones without updating documentation and deployment configuration accordingly."
      ]
    }
  ]
}
